// Test script for record type enhancements
// Tests: default values, mandatory fields, max length validation, and record.validate() function

print "=== Record Type Enhancements Test ===";
print "";

// Test 1: Basic record with field properties
print "Test 1: Record with mandatory field and default value";
var person: record {
    name: string(mandatory),
    age: int(default:0),
    email: string
};

// Should work - mandatory field provided
person = {"name": "John Doe", "email": "john@example.com"};
print "Person: " + person.name + ", Age: " + person.age + ", Email: " + person.email;

// Validate the record
if call record.validate("person") then {
    print "✓ Person record is valid";
} else {
    print "✗ Person record validation failed";
}
print "";

// Test 2: Default value application
print "Test 2: Default value application";
var product: record {
    name: string(mandatory),
    price: double(default:0.0),
    quantity: int(default:1),
    category: string(default:"General")
};

product = {"name": "Widget"};
print "Product: " + product.name;
print "Price: " + product.price;
print "Quantity: " + product.quantity;
print "Category: " + product.category;

if call record.validate("product") then {
    print "✓ Product record is valid";
} else {
    print "✗ Product record validation failed";
}
print "";

// Test 3: Maximum length validation
print "Test 3: Maximum length validation";
var user: record {
    username: string(mandatory, maxlength:20),
    bio: string(maxlength:100)
};

// Should work - within max length
user = {"username": "johndoe123", "bio": "Software developer"};
print "User: " + user.username;
print "Bio: " + user.bio;

if call record.validate("user") then {
    print "✓ User record is valid";
} else {
    print "✗ User record validation failed";
}
print "";

// Test 4: Multiple constraints combined
print "Test 4: Multiple constraints combined";
var employee: record {
    id: int(mandatory),
    name: string(mandatory, maxlength:50),
    email: string(mandatory, maxlength:100),
    department: string(default:"Unassigned"),
    salary: double(default:0.0)
};

employee = {
    "id": 101,
    "name": "Alice Smith",
    "email": "alice@company.com"
};

print "Employee ID: " + employee.id;
print "Name: " + employee.name;
print "Email: " + employee.email;
print "Department: " + employee.department;
print "Salary: " + employee.salary;

if call record.validate("employee") then {
    print "✓ Employee record is valid";
} else {
    print "✗ Employee record validation failed";
}
print "";

// Test 5: Record with all string fields and different properties
print "Test 5: Various field property combinations";
var config: record {
    host: string(mandatory),
    port: int(default:8080),
    ssl: bool(default:false),
    timeout: int(default:30),
    apiKey: string(maxlength:64)
};

config = {"host": "api.example.com", "apiKey": "abc123xyz789"};
print "Host: " + config.host;
print "Port: " + config.port;
print "SSL: " + config.ssl;
print "Timeout: " + config.timeout;
print "API Key: " + config.apiKey;

if call record.validate("config") then {
    print "✓ Config record is valid";
} else {
    print "✗ Config record validation failed";
}
print "";

print "=== All record enhancement tests completed ===";
