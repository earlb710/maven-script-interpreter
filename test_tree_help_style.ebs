// ============================================================================
// test_tree_help_style.ebs - Tree Bidirectional Binding Test (Help Style)
// ============================================================================
// This script tests the bidirectional tree binding feature with a tree
// structure similar to the help system, demonstrating:
// - Tree selection updating the variable
// - Variable updates triggering tree selection changes
// - Nested categories with icons and expanded states
// - Navigation buttons for programmatic selection
// ============================================================================

print "Tree Bidirectional Binding Test - Help Style";
print "=============================================";

screen HelpStyleTreeTest {
    title = "Tree Bidirectional Binding - Help Style Demo"
    width = 900
    height = 650
    
    areas {
        mainLayout {
            type = hbox
            
            areas {
                // Left panel - Tree navigation
                leftPanel {
                    type = vbox
                    hgrow = "always"
                    
                    items {
                        treeTitle {
                            displayItem {
                                type = label
                                labelText = "Documentation Topics"
                                itemFontSize = "16px"
                                itemFontWeight = "bold"
                            }
                        }
                        
                        // Tree view with hierarchical structure
                        helpTree {
                            varRef = selectedTopic
                            displayItem {
                                type = treeview
                                displayRecords = 20
                                showRoot = true
                                treeItems = [
                                    {
                                        value = "Documentation",
                                        icon = "icons/tree-node.png",
                                        expanded = true,
                                        children = [
                                            {
                                                value = "Getting Started",
                                                icon = "icons/tree-node.png",
                                                expanded = true,
                                                children = [
                                                    { value = "Introduction", icon = "icons/help-page.png" },
                                                    { value = "Installation", icon = "icons/help-page.png" },
                                                    { value = "Quick Start", icon = "icons/help-page.png" },
                                                    { value = "First Program", icon = "icons/help-page.png" }
                                                ]
                                            },
                                            {
                                                value = "Language Basics",
                                                icon = "icons/tree-node.png",
                                                expanded = false,
                                                children = [
                                                    {
                                                        value = "Variables",
                                                        icon = "icons/tree-node.png",
                                                        expanded = false,
                                                        children = [
                                                            { value = "Declaration", icon = "icons/info-page.png" },
                                                            { value = "Types", icon = "icons/info-page.png" },
                                                            { value = "Scope", icon = "icons/info-page.png" }
                                                        ]
                                                    },
                                                    { value = "Operators", icon = "icons/info-page.png" },
                                                    { value = "Functions", icon = "icons/info-page.png" },
                                                    { value = "Control Flow", icon = "icons/info-page.png" }
                                                ]
                                            },
                                            {
                                                value = "Data Structures",
                                                icon = "icons/tree-node.png",
                                                expanded = false,
                                                children = [
                                                    { value = "Arrays", icon = "icons/info-page.png" },
                                                    { value = "JSON", icon = "icons/info-page.png" },
                                                    { value = "Maps", icon = "icons/info-page.png" },
                                                    { value = "Sets", icon = "icons/info-page.png" }
                                                ]
                                            },
                                            {
                                                value = "Screen Components",
                                                icon = "icons/tree-node.png",
                                                expanded = false,
                                                children = [
                                                    {
                                                        value = "Input Controls",
                                                        icon = "icons/tree-node.png",
                                                        expanded = false,
                                                        children = [
                                                            { value = "TextField", icon = "icons/normal-page.png" },
                                                            { value = "TextArea", icon = "icons/normal-page.png" },
                                                            { value = "CheckBox", icon = "icons/normal-page.png" },
                                                            { value = "ComboBox", icon = "icons/normal-page.png" }
                                                        ]
                                                    },
                                                    {
                                                        value = "Display Controls",
                                                        icon = "icons/tree-node.png",
                                                        expanded = false,
                                                        children = [
                                                            { value = "Label", icon = "icons/normal-page.png" },
                                                            { value = "ImageView", icon = "icons/normal-page.png" },
                                                            { value = "WebView", icon = "icons/normal-page.png" }
                                                        ]
                                                    },
                                                    { value = "Button", icon = "icons/normal-page.png" },
                                                    { value = "TreeView", icon = "icons/normal-page.png" }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        value = "Examples",
                                        icon = "icons/tree-node.png",
                                        expanded = false,
                                        children = [
                                            { value = "Hello World", icon = "icons/help-page.png" },
                                            { value = "Calculator", icon = "icons/help-page.png" },
                                            { value = "File Manager", icon = "icons/help-page.png" },
                                            { value = "Database App", icon = "icons/help-page.png" }
                                        ]
                                    },
                                    {
                                        value = "API Reference",
                                        icon = "icons/tree-node.png",
                                        expanded = false,
                                        children = [
                                            {
                                                value = "String Functions",
                                                icon = "icons/tree-node.png",
                                                expanded = false,
                                                children = [
                                                    { value = "str.trim", icon = "icons/help-page.png" },
                                                    { value = "str.split", icon = "icons/help-page.png" },
                                                    { value = "str.replace", icon = "icons/help-page.png" },
                                                    { value = "str.substring", icon = "icons/help-page.png" }
                                                ]
                                            },
                                            {
                                                value = "Array Functions",
                                                icon = "icons/tree-node.png",
                                                expanded = false,
                                                children = [
                                                    { value = "array.add", icon = "icons/help-page.png" },
                                                    { value = "array.remove", icon = "icons/help-page.png" },
                                                    { value = "array.sort", icon = "icons/help-page.png" },
                                                    { value = "array.length", icon = "icons/help-page.png" }
                                                ]
                                            },
                                            { value = "File I/O", icon = "icons/tree-node.png" },
                                            { value = "Database", icon = "icons/tree-node.png" }
                                        ]
                                    }
                                ]
                                
                                // onChange event to update the content display
                                onChange = "
                                    if selectedTopic != '' then {
                                        call scr.setProperty('HelpStyleTreeTest.topicTitle', 'labelText', 
                                            'Topic: ' + selectedTopic);
                                        call scr.setProperty('HelpStyleTreeTest.topicContent', 'labelText', 
                                            'Showing content for: ' + selectedTopic + 
                                            '\\n\\nThis demonstrates bidirectional binding where:\\n' +
                                            '• Clicking tree items updates the variable\\n' +
                                            '• Setting the variable updates the tree selection\\n' +
                                            '• Parent nodes expand automatically\\n' +
                                            '• Tree scrolls to show the selected item');
                                        call print('Selected topic: ' + selectedTopic);
                                    } else {
                                        call scr.setProperty('HelpStyleTreeTest.topicTitle', 'labelText', 
                                            'Topic: (none selected)');
                                        call scr.setProperty('HelpStyleTreeTest.topicContent', 'labelText', 
                                            'Select a topic from the tree or use the navigation buttons below.');
                                    }
                                "
                            }
                        }
                    }
                }
                
                // Right panel - Content area
                rightPanel {
                    type = vbox
                    hgrow = "always"
                    
                    items {
                        topicTitle {
                            displayItem {
                                type = label
                                labelText = "Topic: (none selected)"
                                itemFontSize = "18px"
                                itemFontWeight = "bold"
                            }
                        }
                        
                        separator1 {
                            displayItem {
                                type = separator
                            }
                        }
                        
                        topicContent {
                            displayItem {
                                type = label
                                labelText = "Select a topic from the tree or use the navigation buttons below."
                                itemFontSize = "12px"
                            }
                        }
                        
                        separator2 {
                            displayItem {
                                type = separator
                            }
                        }
                        
                        navTitle {
                            displayItem {
                                type = label
                                labelText = "Quick Navigation (Tests Bidirectional Binding)"
                                itemFontSize = "14px"
                                itemFontWeight = "bold"
                            }
                        }
                        
                        // Navigation buttons to test programmatic selection
                        buttonRow1 {
                            type = hbox
                            items {
                                btn1 {
                                    displayItem {
                                        type = button
                                        labelText = "Introduction"
                                        onClick = "selectedTopic = 'Introduction';"
                                    }
                                }
                                btn2 {
                                    displayItem {
                                        type = button
                                        labelText = "Quick Start"
                                        onClick = "selectedTopic = 'Quick Start';"
                                    }
                                }
                                btn3 {
                                    displayItem {
                                        type = button
                                        labelText = "Variables"
                                        onClick = "selectedTopic = 'Variables';"
                                    }
                                }
                            }
                        }
                        
                        buttonRow2 {
                            type = hbox
                            items {
                                btn4 {
                                    displayItem {
                                        type = button
                                        labelText = "Declaration"
                                        onClick = "selectedTopic = 'Declaration';"
                                    }
                                }
                                btn5 {
                                    displayItem {
                                        type = button
                                        labelText = "TreeView"
                                        onClick = "selectedTopic = 'TreeView';"
                                    }
                                }
                                btn6 {
                                    displayItem {
                                        type = button
                                        labelText = "TextField"
                                        onClick = "selectedTopic = 'TextField';"
                                    }
                                }
                            }
                        }
                        
                        buttonRow3 {
                            type = hbox
                            items {
                                btn7 {
                                    displayItem {
                                        type = button
                                        labelText = "str.trim"
                                        onClick = "selectedTopic = 'str.trim';"
                                    }
                                }
                                btn8 {
                                    displayItem {
                                        type = button
                                        labelText = "array.sort"
                                        onClick = "selectedTopic = 'array.sort';"
                                    }
                                }
                                btn9 {
                                    displayItem {
                                        type = button
                                        labelText = "Calculator"
                                        onClick = "selectedTopic = 'Calculator';"
                                    }
                                }
                            }
                        }
                        
                        buttonRow4 {
                            type = hbox
                            items {
                                btnRoot {
                                    displayItem {
                                        type = button
                                        labelText = "Documentation (Root)"
                                        onClick = "selectedTopic = 'Documentation';"
                                    }
                                }
                                btnClear {
                                    displayItem {
                                        type = button
                                        labelText = "Clear Selection"
                                        onClick = "selectedTopic = '';"
                                    }
                                }
                            }
                        }
                        
                        instructionsLabel {
                            displayItem {
                                type = label
                                labelText = "Instructions: Click tree items OR click buttons above to test bidirectional binding"
                                itemFontSize = "11px"
                                itemFontStyle = "italic"
                            }
                        }
                    }
                }
            }
        }
    }
}

// Show the screen
show screen HelpStyleTreeTest;

print "";
print "Test Instructions:";
print "==================";
print "1. Click on tree items - observe the variable updates and content changes";
print "2. Click Quick Navigation buttons - observe tree selection updates";
print "3. Notice how nested items cause parent nodes to expand automatically";
print "4. Notice how the tree scrolls to make selected items visible";
print "5. Test 'Clear Selection' button to clear the tree selection";
print "";
print "The tree structure mimics the help system with:";
print "- Root node with icon";
print "- Multiple levels of nesting";
print "- Different icon types for different node types";
print "- Expanded and collapsed states";
