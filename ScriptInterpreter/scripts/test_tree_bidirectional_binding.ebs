// Test script to demonstrate bidirectional tree binding
// The tree selection updates the variable, and setting the variable updates the tree selection

// Build tree structure
var treeData: array[*] = [];

var docsChildren: array[*] = [];
call array.add(docsChildren, {"value": "README.md"});
call array.add(docsChildren, {"value": "TODO.txt"});
call array.add(docsChildren, {"value": "Notes.md"});

var projectsChildren: array[*] = [];
call array.add(projectsChildren, {"value": "Project1"});
call array.add(projectsChildren, {"value": "Project2"});
call array.add(projectsChildren, {"value": "Project3"});

var imagesChildren: array[*] = [];
call array.add(imagesChildren, {"value": "photo1.jpg"});
call array.add(imagesChildren, {"value": "photo2.png"});

var rootChildren: array[*] = [];
call array.add(rootChildren, {"value": "Documents", "expanded": false, "children": $docsChildren});
call array.add(rootChildren, {"value": "Projects", "expanded": false, "children": $projectsChildren});
call array.add(rootChildren, {"value": "Images", "expanded": false, "children": $imagesChildren});

call array.add(treeData, {"value": "Root", "expanded": true, "children": $rootChildren});

screen TreeBindingTest = {
    "title": "Tree Bidirectional Binding Test",
    "width": 700,
    "height": 500,
    "vars": [
        {
            "name": "selectedFile",
            "type": "string",
            "default": "",
            "display": {
                "type": "treeview",
                "displayRecords": 12,
                "showRoot": true,
                "treeItems": $treeData,
                "onChange": "call scr.setProperty('TreeBindingTest.selectionLabel', 'labelText', 'Current selection: ' + selectedFile);"
            }
        },
        {
            "name": "instructionsLabel",
            "type": "string",
            "default": "Test bidirectional tree binding: Click tree items OR set the variable using buttons",
            "display": {
                "type": "label",
                "itemFontSize": "14px",
                "itemBold": true
            }
        },
        {
            "name": "selectionLabel",
            "type": "string",
            "default": "Current selection: (none)",
            "display": {
                "type": "label",
                "itemFontSize": "12px"
            }
        }
    ],
    "area": [
        {
            "name": "mainArea",
            "type": "vbox",
            "items": [
                {"varRef": "instructionsLabel"},
                {"varRef": "selectionLabel"},
                {"varRef": "selectedFile"},
                {
                    "name": "selectRootBtn",
                    "display": {
                        "type": "button",
                        "labelText": "Select Root",
                        "onClick": "selectedFile = 'Root';"
                    }
                },
                {
                    "name": "selectDocBtn",
                    "display": {
                        "type": "button",
                        "labelText": "Select Documents",
                        "onClick": "selectedFile = 'Documents';"
                    }
                },
                {
                    "name": "selectReadmeBtn",
                    "display": {
                        "type": "button",
                        "labelText": "Select README.md",
                        "onClick": "selectedFile = 'README.md';"
                    }
                },
                {
                    "name": "selectProject2Btn",
                    "display": {
                        "type": "button",
                        "labelText": "Select Project2",
                        "onClick": "selectedFile = 'Project2';"
                    }
                },
                {
                    "name": "clearBtn",
                    "display": {
                        "type": "button",
                        "labelText": "Clear Selection",
                        "onClick": "selectedFile = '';"
                    }
                },
                {
                    "name": "resultsLabel",
                    "display": {
                        "type": "label",
                        "labelText": "Test: Click tree items, then click buttons to verify bidirectional binding",
                        "itemFontSize": "11px",
                        "itemItalic": true
                    }
                }
            ]
        }
    ]
};

show screen TreeBindingTest;

print "Tree Bidirectional Binding Test";
print "================================";
print "1. Click on tree items - observe the variable updates";
print "2. Click buttons to set the variable - observe the tree selection changes";
print "3. The tree should expand parent nodes and scroll to show the selected item";
