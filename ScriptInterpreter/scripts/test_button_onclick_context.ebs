// Test Script: Button onClick Screen Context
// Description: Tests that button onClick handlers execute with proper screen context
//              allowing contextual screen statements like "close screen;" and "hide screen;"
//              to work without explicit screen names
// Date: 2025-11-20

print "=== Button onClick Screen Context Test Suite ===";
print "";
print "This test demonstrates that onClick handlers can now use screen statements";
print "without explicit screen names (e.g., 'close screen;' instead of 'close screen myScreen;')";
print "";

// Test 1: Button that closes screen using contextual statement
print "Test 1: Creating screen with 'Close' button using contextual 'close screen;' statement";
screen test1Screen = {
    "title": "Test 1: Close Screen Context",
    "width": 400,
    "height": 250,
    "area": [
        {
            "name": "mainArea",
            "type": "vbox",
            "spacing": "15",
            "padding": "20",
            "items": [
                {
                    "name": "instructions",
                    "seq": 1,
                    "display": {
                        "type": "label",
                        "labelText": "Click the button below to close this screen.\nThe onClick handler uses 'close screen;' without\nexplicitly naming the screen."
                    }
                },
                {
                    "name": "closeButton",
                    "seq": 2,
                    "display": {
                        "type": "button",
                        "labelText": "Close This Screen",
                        "onClick": "print 'Executing: close screen;'; close screen;"
                    }
                }
            ]
        }
    ]
};

// Test 2: Button that hides screen using contextual statement
print "Test 2: Creating screen with 'Hide' button using contextual 'hide screen;' statement";
screen test2Screen = {
    "title": "Test 2: Hide Screen Context",
    "width": 400,
    "height": 250,
    "area": [
        {
            "name": "mainArea",
            "type": "vbox",
            "spacing": "15",
            "padding": "20",
            "items": [
                {
                    "name": "instructions",
                    "seq": 1,
                    "display": {
                        "type": "label",
                        "labelText": "Click the button to hide this screen.\nYou can show it again with: show screen test2Screen;"
                    }
                },
                {
                    "name": "hideButton",
                    "seq": 2,
                    "display": {
                        "type": "button",
                        "labelText": "Hide This Screen",
                        "onClick": "print 'Executing: hide screen;'; hide screen;"
                    }
                }
            ]
        }
    ]
};

// Test 3: Button with variable manipulation and contextual close
print "Test 3: Creating screen with counter variable and contextual operations";
screen test3Screen = {
    "title": "Test 3: Variable Operations + Close",
    "width": 450,
    "height": 350,
    "vars": [
        {
            "name": "counter",
            "type": "int",
            "default": 0,
            "display": {
                "type": "textfield",
                "labelText": "Counter:",
                "alignment": "right"
            }
        },
        {
            "name": "message",
            "type": "string",
            "default": "Click 'Increment' to start",
            "display": {
                "type": "textfield",
                "labelText": "Status:",
                "alignment": "left"
            }
        }
    ],
    "area": [
        {
            "name": "mainArea",
            "type": "vbox",
            "spacing": "15",
            "padding": "20",
            "items": [
                {
                    "name": "instructions",
                    "seq": 1,
                    "display": {
                        "type": "label",
                        "labelText": "Test variable manipulation within onClick handlers.\nAll operations use the screen's context automatically."
                    }
                },
                {
                    "name": "counter",
                    "varRef": "counter",
                    "seq": 2
                },
                {
                    "name": "message",
                    "varRef": "message",
                    "seq": 3
                },
                {
                    "name": "incrementButton",
                    "seq": 4,
                    "display": {
                        "type": "button",
                        "labelText": "Increment Counter",
                        "onClick": "counter = counter + 1; message = 'Counter incremented to ' + counter; print 'Counter is now: ' + counter;"
                    }
                },
                {
                    "name": "resetButton",
                    "seq": 5,
                    "display": {
                        "type": "button",
                        "labelText": "Reset Counter",
                        "onClick": "counter = 0; message = 'Counter reset to 0'; print 'Counter reset';"
                    }
                },
                {
                    "name": "closeButton",
                    "seq": 6,
                    "display": {
                        "type": "button",
                        "labelText": "Close Screen",
                        "onClick": "print 'Final counter value: ' + counter; print 'Closing screen...'; close screen;"
                    }
                }
            ]
        }
    ]
};

// Test 4: Multiple buttons with different contextual operations
print "Test 4: Creating screen with multiple contextual operations";
screen test4Screen = {
    "title": "Test 4: Multiple Context Operations",
    "width": 450,
    "height": 300,
    "vars": [
        {
            "name": "clickCount",
            "type": "int",
            "default": 0,
            "display": {
                "type": "textfield",
                "labelText": "Button Clicks:",
                "alignment": "right"
            }
        }
    ],
    "area": [
        {
            "name": "mainArea",
            "type": "vbox",
            "spacing": "15",
            "padding": "20",
            "items": [
                {
                    "name": "instructions",
                    "seq": 1,
                    "display": {
                        "type": "label",
                        "labelText": "Each button demonstrates a different contextual operation."
                    }
                },
                {
                    "name": "clickCount",
                    "varRef": "clickCount",
                    "seq": 2
                },
                {
                    "name": "trackButton",
                    "seq": 3,
                    "display": {
                        "type": "button",
                        "labelText": "Track Clicks",
                        "onClick": "clickCount = clickCount + 1; print 'Button clicked ' + clickCount + ' times';"
                    }
                },
                {
                    "name": "hideButton",
                    "seq": 4,
                    "display": {
                        "type": "button",
                        "labelText": "Hide (can show again)",
                        "onClick": "print 'Hiding screen (clicks: ' + clickCount + ')'; hide screen;"
                    }
                },
                {
                    "name": "closeButton",
                    "seq": 5,
                    "display": {
                        "type": "button",
                        "labelText": "Close (permanent)",
                        "onClick": "print 'Closing screen (total clicks: ' + clickCount + ')'; close screen;"
                    }
                }
            ]
        }
    ]
};

// Display instructions for running tests
print "";
print "=== Test Screens Created ===";
print "";
print "Four test screens have been created. To run the tests:";
print "";
print "1. show screen test1Screen;";
print "   - Click 'Close This Screen' button";
print "   - Verifies: onClick can use 'close screen;' contextually";
print "";
print "2. show screen test2Screen;";
print "   - Click 'Hide This Screen' button";
print "   - Verifies: onClick can use 'hide screen;' contextually";
print "   - To show again: show screen test2Screen;";
print "";
print "3. show screen test3Screen;";
print "   - Click 'Increment Counter' multiple times";
print "   - Click 'Reset Counter' to reset";
print "   - Click 'Close Screen' to close";
print "   - Verifies: onClick can manipulate variables and close contextually";
print "";
print "4. show screen test4Screen;";
print "   - Click 'Track Clicks' to increment counter";
print "   - Click 'Hide' to hide (can show again with: show screen test4Screen;)";
print "   - Click 'Close' to close permanently";
print "   - Verifies: Multiple contextual operations work correctly";
print "";
print "=== Expected Behavior ===";
print "Before this fix: onClick handlers would fail with 'no screen name specified'";
print "After this fix: All contextual screen statements work without explicit names";
print "";
print "Showing first test screen now...";
print "";

// Show the first test screen automatically
show screen test1Screen;
