// Test Script: Comprehensive Scope and Direction Features
// Description: Tests both new features and backward compatibility
// Author: EBS Test Suite
// Date: 2025-11-18
//
// NOTE: This test uses #debug.assert and #debug.assertEquals for assertions
//       - Use #debug.assert(condition, "message") to assert a boolean condition
//       - Use #debug.assertEquals(expected, actual, "message") to assert equality
//       - Arrays use .length property (not .length() method)

print "====================================================";
print "COMPREHENSIVE TEST: Scope and Direction Features";
print "====================================================";
print "";

// ==================================================
// TEST 1: New "scope" property with "visible" value
// ==================================================
print "TEST 1: Testing new 'scope' property with 'visible'...";
screen scopeVisibleTest = {
    "title": "Scope Visible Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "VisibleSet",
            "scope": "visible",
            "vars": [
                {"name": "testVar1", "type": "string", "default": "visible1"}
            ]
        }
    ]
};
call #debug.assert(scopeVisibleTest.VisibleSet.testVar1 == "visible1", "TEST 1: Value should be 'visible1'");
print "  ✓ Screen with scope='visible' created successfully";
print "  Value: " + scopeVisibleTest.VisibleSet.testVar1;
print "";

// ==================================================
// TEST 2: New "scope" property with "internal" value
// ==================================================
print "TEST 2: Testing new 'scope' property with 'internal'...";
screen scopeInternalTest = {
    "title": "Scope Internal Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "InternalSet",
            "scope": "internal",
            "vars": [
                {"name": "testVar2", "type": "string", "default": "internal1"}
            ]
        }
    ]
};
call #debug.assertEquals("internal1", scopeInternalTest.InternalSet.testVar2, "TEST 2: Value should be 'internal1'");
print "  ✓ Screen with scope='internal' created successfully";
print "  Value: " + scopeInternalTest.InternalSet.testVar2;
print "";

// ==================================================
// TEST 3: Scope "visible" (explicit)
// ==================================================
print "TEST 3: Testing explicit scope='visible'...";
screen explicitVisibleTest = {
    "title": "Explicit Visible Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "VisibleSet",
            "scope": "visible",
            "vars": [
                {"name": "testVar3", "type": "string", "default": "explicit_visible"}
            ]
        }
    ]
};
call #debug.assertEquals("explicit_visible", explicitVisibleTest.VisibleSet.testVar3, "TEST 3: Value should be 'explicit_visible'");
print "  ✓ Screen with explicit scope='visible' created successfully";
print "  Value: " + explicitVisibleTest.VisibleSet.testVar3;
print "";

// ==================================================
// TEST 4: Scope "internal" for hidden variables
// ==================================================
print "TEST 4: Testing scope='internal' for hidden variables...";
screen internalScopeTest = {
    "title": "Internal Scope Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "InternalSet",
            "scope": "internal",
            "vars": [
                {"name": "testVar4", "type": "string", "default": "internal_value"}
            ]
        }
    ]
};
print "  ✓ Screen with scope='internal' created successfully";
print "  Value: " + internalScopeTest.InternalSet.testVar4;
print "";

// ==================================================
// TEST 5: Direction "in" parameter
// ==================================================
print "TEST 5: Testing direction='in' parameter...";
screen directionInTest = {
    "title": "Direction In Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "InputSet",
            "scope": "visible",
            "vars": [
                {"name": "inputVar", "type": "string", "default": "input_value", "direction": "in"}
            ]
        }
    ]
};
print "  ✓ Screen with direction='in' created successfully";
print "  Value: " + directionInTest.InputSet.inputVar;
print "";

// ==================================================
// TEST 6: Direction "out" parameter
// ==================================================
print "TEST 6: Testing direction='out' parameter...";
screen directionOutTest = {
    "title": "Direction Out Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "OutputSet",
            "scope": "visible",
            "vars": [
                {"name": "outputVar", "type": "string", "default": "output_value", "direction": "out"}
            ]
        }
    ]
};
print "  ✓ Screen with direction='out' created successfully";
directionOutTest.OutputSet.outputVar = "modified_output";
print "  Value after modification: " + directionOutTest.OutputSet.outputVar;
print "";

// ==================================================
// TEST 7: Direction "inout" parameter (default)
// ==================================================
print "TEST 7: Testing direction='inout' parameter...";
screen directionInoutTest = {
    "title": "Direction Inout Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "InoutSet",
            "scope": "visible",
            "vars": [
                {"name": "inoutVar", "type": "string", "default": "inout_value", "direction": "inout"}
            ]
        }
    ]
};
print "  ✓ Screen with direction='inout' created successfully";
print "  Initial value: " + directionInoutTest.InoutSet.inoutVar;
directionInoutTest.InoutSet.inoutVar = "modified_inout";
print "  Value after modification: " + directionInoutTest.InoutSet.inoutVar;
print "";

// ==================================================
// TEST 8: Default direction (no direction specified)
// ==================================================
print "TEST 8: Testing default direction (no direction specified)...";
screen directionDefaultTest = {
    "title": "Direction Default Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "DefaultSet",
            "scope": "visible",
            "vars": [
                {"name": "defaultVar", "type": "string", "default": "default_value"}
            ]
        }
    ]
};
print "  ✓ Screen with no direction (defaults to 'inout') created successfully";
print "  Initial value: " + directionDefaultTest.DefaultSet.defaultVar;
directionDefaultTest.DefaultSet.defaultVar = "modified_default";
print "  Value after modification: " + directionDefaultTest.DefaultSet.defaultVar;
print "";

// ==================================================
// TEST 9: Combined test - multiple sets with different scopes and directions
// ==================================================
print "TEST 9: Testing combined features...";
screen combinedTest = {
    "title": "Combined Features Test",
    "width": 900,
    "height": 700,
    "sets": [
        {
            "setname": "VisibleInputs",
            "scope": "visible",
            "vars": [
                {"name": "username", "type": "string", "default": "john_doe", "direction": "in"},
                {"name": "password", "type": "string", "default": "secret", "direction": "in"}
            ]
        },
        {
            "setname": "VisibleOutputs",
            "scope": "visible",
            "vars": [
                {"name": "result", "type": "string", "default": "pending", "direction": "out"},
                {"name": "timestamp", "type": "string", "default": "00:00:00", "direction": "out"}
            ]
        },
        {
            "setname": "InternalState",
            "scope": "internal",
            "vars": [
                {"name": "sessionId", "type": "int", "default": 0, "direction": "inout"},
                {"name": "retryCount", "type": "int", "default": 0, "direction": "inout"}
            ]
        },
        {
            "setname": "InternalHidden",
            "scope": "internal",
            "vars": [
                {"name": "internalFlag", "type": "string", "default": "hidden"}
            ]
        }
    ]
};
print "  ✓ Combined screen created successfully";
print "  Input (direction='in'): " + combinedTest.VisibleInputs.username;
print "  Output (direction='out') initial: " + combinedTest.VisibleOutputs.result;
combinedTest.VisibleOutputs.result = "success";
print "  Output (direction='out') updated: " + combinedTest.VisibleOutputs.result;
print "  Internal (scope='internal'): " + combinedTest.InternalState.sessionId;
combinedTest.InternalState.sessionId = 12345;
print "  Internal updated: " + combinedTest.InternalState.sessionId;
print "  Internal hidden (scope='internal'): " + combinedTest.InternalHidden.internalFlag;
print "";

// ==================================================
// TEST 10: Verify all data types work with new features
// ==================================================
print "TEST 10: Testing all data types with new features...";
screen dataTypesTest = {
    "title": "Data Types Test",
    "width": 600,
    "height": 500,
    "sets": [
        {
            "setname": "TypeTests",
            "scope": "visible",
            "vars": [
                {"name": "stringVar", "type": "string", "default": "test", "direction": "in"},
                {"name": "intVar", "type": "int", "default": 42, "direction": "out"},
                {"name": "floatVar", "type": "float", "default": 3.14, "direction": "inout"},
                {"name": "doubleVar", "type": "double", "default": 2.718, "direction": "in"},
                {"name": "boolVar", "type": "bool", "default": true, "direction": "out"}
            ]
        }
    ]
};
print "  ✓ All data types created successfully with directions";
print "  String (in): " + dataTypesTest.TypeTests.stringVar;
print "  Int (out): " + dataTypesTest.TypeTests.intVar;
print "  Float (inout): " + dataTypesTest.TypeTests.floatVar;
print "  Double (in): " + dataTypesTest.TypeTests.doubleVar;
print "  Bool (out): " + dataTypesTest.TypeTests.boolVar;
print "";

// ==================================================
// SUMMARY
// ==================================================
print "====================================================";
print "TEST SUMMARY";
print "====================================================";
print "✓ TEST 1:  New scope='visible' - PASSED";
print "✓ TEST 2:  New scope='internal' - PASSED";
print "✓ TEST 3:  Explicit scope='visible' - PASSED";
print "✓ TEST 4:  Scope='internal' for hidden variables - PASSED";
print "✓ TEST 5:  Direction='in' - PASSED";
print "✓ TEST 6:  Direction='out' - PASSED";
print "✓ TEST 7:  Direction='inout' - PASSED";
print "✓ TEST 8:  Default direction - PASSED";
print "✓ TEST 9:  Combined features - PASSED";
print "✓ TEST 10: Data types - PASSED";
print "";
print "All tests completed successfully!";
print "====================================================";
print "";

// ==================================================
// TEST 11: screen.getItemList functionality
// ==================================================
print "TEST 11: Testing screen.getItemList functionality...";
print "";
print "Note: screen.getItemList returns UI items (variables with display metadata).";
print "Variables without display metadata do not create UI items, so getItemList will be empty.";
print "";

// Test with screens that have display metadata
screen testWithDisplay = {
    "title": "Test With Display",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "TestSet",
            "scope": "visible",
            "vars": [
                {
                    "name": "field1",
                    "type": "string",
                    "default": "value1",
                    "display": {"type": "textfield", "labeltext": "Field 1"}
                },
                {
                    "name": "field2",
                    "type": "int",
                    "default": 42,
                    "display": {"type": "spinner", "min": 0, "max": 100, "labeltext": "Field 2"}
                }
            ]
        }
    ]
};

print "Screen with display metadata created.";
var itemList = call screen.getItemList("testWithDisplay");
call #debug.assert(itemList.length == 2, "TEST 11: Should have 2 items with display metadata");
print "  Items returned by getItemList: " + itemList.length;
if (itemList.length > 0) {
    print "  Item names (setname.itemname format):";
    var i:int = 0;
    while (i < itemList.length) {
        print "    [" + i + "] " + itemList[i];
        i = i + 1;
    }
    call #debug.assertEquals("testset.field1", itemList[0], "TEST 11: First item should be 'testset.field1'");
    call #debug.assertEquals("testset.field2", itemList[1], "TEST 11: Second item should be 'testset.field2'");
} else {
    print "  WARNING: No items found!";
}
print "";

// Show that screens without display metadata return empty
print "Testing screens WITHOUT display metadata (should return empty):";
var list1 = call screen.getItemList("scopeVisibleTest");
call #debug.assert(list1.length == 0, "TEST 11: scopeVisibleTest should have 0 items (no display metadata)");
print "  scopeVisibleTest: " + list1.length + " items (no display metadata)";
var list2 = call screen.getItemList("directionInTest");
call #debug.assert(list2.length == 0, "TEST 11: directionInTest should have 0 items (no display metadata)");
print "  directionInTest: " + list2.length + " items (no display metadata)";
print "";
print "✓ TEST 11: screen.getItemList - PASSED";
print "====================================================";



