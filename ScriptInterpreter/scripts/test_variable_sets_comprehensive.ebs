// Test Script: Comprehensive Variable Sets Test
// Description: Comprehensive test of the new variable sets structure
// Author: EBS Test Suite
// Date: 2025-11-17
// Purpose: Tests all aspects of the new sets structure including storage, 
//          AreaItem linking, hidden sets, and various data types

print "========================================";
print "Comprehensive Variable Sets Test";
print "========================================";
print "";

// Test 1: Multiple sets with different visibility
print "TEST 1: Creating screen with multiple variable sets...";
screen comprehensiveScreen = {
    "title": "Comprehensive Variable Sets Test",
    "width": 900,
    "height": 700,
    "sets": [
        {
            "setname": "BasicInfo",
            "hiddenind": "N",
            "vars": [
                {
                    "name": "fullName",
                    "type": "string",
                    "default": "John Smith",
                    "display": {
                        "type": "textfield",
                        "labeltext": "Full Name:",
                        "mandatory": true
                    }
                },
                {
                    "name": "birthYear",
                    "type": "int",
                    "default": 1990,
                    "display": {
                        "type": "spinner",
                        "min": 1900,
                        "max": 2025,
                        "labeltext": "Birth Year:"
                    }
                },
                {
                    "name": "isActive",
                    "type": "bool",
                    "default": true,
                    "display": {
                        "type": "checkbox",
                        "labeltext": "Active Status"
                    }
                }
            ]
        },
        {
            "setname": "ContactDetails",
            "hiddenind": "N",
            "vars": [
                {
                    "name": "emailAddress",
                    "type": "string",
                    "default": "john.smith@example.com",
                    "display": {
                        "type": "textfield",
                        "labeltext": "Email:",
                        "pattern": "^[\\w.-]+@[\\w.-]+\\.\\w+$"
                    }
                },
                {
                    "name": "phoneNumber",
                    "type": "string",
                    "default": "555-0100",
                    "display": {
                        "type": "textfield",
                        "labeltext": "Phone:"
                    }
                },
                {
                    "name": "country",
                    "type": "string",
                    "default": "USA",
                    "display": {
                        "type": "combobox",
                        "labeltext": "Country:",
                        "options": ["USA", "Canada", "UK", "Australia"]
                    }
                }
            ]
        },
        {
            "setname": "Preferences",
            "hiddenind": "N",
            "vars": [
                {
                    "name": "theme",
                    "type": "string",
                    "default": "Light",
                    "display": {
                        "type": "choicebox",
                        "labeltext": "Theme:",
                        "options": ["Light", "Dark", "Auto"]
                    }
                },
                {
                    "name": "fontSize",
                    "type": "int",
                    "default": 12,
                    "display": {
                        "type": "slider",
                        "min": 8,
                        "max": 24,
                        "labeltext": "Font Size:"
                    }
                }
            ]
        },
        {
            "setname": "InternalData",
            "hiddenind": "Y",
            "vars": [
                {
                    "name": "userId",
                    "type": "int",
                    "default": 10001
                },
                {
                    "name": "sessionToken",
                    "type": "string",
                    "default": "token-abc-123-xyz"
                },
                {
                    "name": "lastLoginTime",
                    "type": "string",
                    "default": "2025-11-17T10:00:00Z"
                },
                {
                    "name": "accessLevel",
                    "type": "int",
                    "default": 5
                }
            ]
        },
        {
            "setname": "SystemFlags",
            "hiddenind": "Y",
            "vars": [
                {
                    "name": "debugMode",
                    "type": "bool",
                    "default": false
                },
                {
                    "name": "autoSave",
                    "type": "bool",
                    "default": true
                }
            ]
        }
    ]
};

print "✓ Screen created successfully!";
print "";

// Test 2: Variable access from visible sets
print "TEST 2: Accessing variables from visible sets...";
print "BasicInfo.fullName: " + comprehensiveScreen.BasicInfo.fullName;
print "BasicInfo.birthYear: " + comprehensiveScreen.BasicInfo.birthYear;
print "BasicInfo.isActive: " + comprehensiveScreen.BasicInfo.isActive;
print "ContactDetails.emailAddress: " + comprehensiveScreen.ContactDetails.emailAddress;
print "ContactDetails.phoneNumber: " + comprehensiveScreen.ContactDetails.phoneNumber;
print "ContactDetails.country: " + comprehensiveScreen.ContactDetails.country;
print "Preferences.theme: " + comprehensiveScreen.Preferences.theme;
print "Preferences.fontSize: " + comprehensiveScreen.Preferences.fontSize;
print "✓ All visible set variables accessible";
print "";

// Test 3: Variable access from hidden sets
print "TEST 3: Accessing variables from hidden sets...";
print "InternalData.userId: " + comprehensiveScreen.InternalData.userId;
print "InternalData.sessionToken: " + comprehensiveScreen.InternalData.sessionToken;
print "InternalData.lastLoginTime: " + comprehensiveScreen.InternalData.lastLoginTime;
print "InternalData.accessLevel: " + comprehensiveScreen.InternalData.accessLevel;
print "SystemFlags.debugMode: " + comprehensiveScreen.SystemFlags.debugMode;
print "SystemFlags.autoSave: " + comprehensiveScreen.SystemFlags.autoSave;
print "✓ All hidden set variables accessible";
print "";

// Test 4: Modifying variables across different sets
print "TEST 4: Modifying variables across different sets...";
comprehensiveScreen.BasicInfo.fullName = "Jane Doe";
comprehensiveScreen.BasicInfo.birthYear = 1995;
comprehensiveScreen.BasicInfo.isActive = false;
comprehensiveScreen.ContactDetails.emailAddress = "jane.doe@example.com";
comprehensiveScreen.ContactDetails.phoneNumber = "555-0200";
comprehensiveScreen.ContactDetails.country = "Canada";
comprehensiveScreen.Preferences.theme = "Dark";
comprehensiveScreen.Preferences.fontSize = 14;
comprehensiveScreen.InternalData.userId = 10002;
comprehensiveScreen.InternalData.sessionToken = "token-def-456-uvw";
comprehensiveScreen.SystemFlags.debugMode = true;
comprehensiveScreen.SystemFlags.autoSave = false;

print "Modified values:";
print "  fullName: " + comprehensiveScreen.BasicInfo.fullName;
print "  birthYear: " + comprehensiveScreen.BasicInfo.birthYear;
print "  isActive: " + comprehensiveScreen.BasicInfo.isActive;
print "  emailAddress: " + comprehensiveScreen.ContactDetails.emailAddress;
print "  country: " + comprehensiveScreen.ContactDetails.country;
print "  theme: " + comprehensiveScreen.Preferences.theme;
print "  userId: " + comprehensiveScreen.InternalData.userId;
print "  debugMode: " + comprehensiveScreen.SystemFlags.debugMode;
print "✓ All variables modified successfully";
print "";

// Test 5: Test with areas and AreaItem linking
print "TEST 5: Creating screen with areas and AreaItem linking...";
screen areaTestScreen = {
    "title": "AreaItem Linking Test",
    "width": 600,
    "height": 400,
    "sets": [
        {
            "setname": "FormData",
            "hiddenind": "N",
            "vars": [
                {
                    "name": "fieldOne",
                    "type": "string",
                    "default": "Value 1",
                    "display": {"type": "textfield"}
                },
                {
                    "name": "fieldTwo",
                    "type": "string",
                    "default": "Value 2",
                    "display": {"type": "textfield"}
                },
                {
                    "name": "fieldThree",
                    "type": "int",
                    "default": 100,
                    "display": {"type": "spinner", "min": 0, "max": 1000}
                }
            ]
        }
    ],
    "area": [
        {
            "name": "mainArea",
            "type": "vbox",
            "items": [
                {
                    "name": "field1_item",
                    "varref": "fieldOne",
                    "sequence": 1
                },
                {
                    "name": "field2_item",
                    "varref": "fieldTwo",
                    "sequence": 2
                },
                {
                    "name": "field3_item",
                    "varref": "fieldThree",
                    "sequence": 3
                }
            ]
        }
    ]
};

print "✓ Screen with areas created successfully!";
print "  Testing AreaItem variable access:";
print "  fieldOne: " + areaTestScreen.FormData.fieldOne;
print "  fieldTwo: " + areaTestScreen.FormData.fieldTwo;
print "  fieldThree: " + areaTestScreen.FormData.fieldThree;
print "";

// Test 6: Test type conversion and validation
print "TEST 6: Testing type conversion and different data types...";
comprehensiveScreen.BasicInfo.birthYear = "2000";  // String to int
comprehensiveScreen.Preferences.fontSize = "16";      // String to int
print "  birthYear (converted from string): " + comprehensiveScreen.BasicInfo.birthYear;
print "  fontSize (converted from string): " + comprehensiveScreen.Preferences.fontSize;
print "✓ Type conversion working";
print "";

// Test 7: Edge cases
print "TEST 7: Testing edge cases...";
screen edgeCaseScreen = {
    "title": "Edge Cases",
    "width": 400,
    "height": 300,
    "sets": [
        {
            "setname": "EmptySet",
            "hiddenind": "N",
            "vars": []
        },
        {
            "setname": "SingleVar",
            "hiddenind": "Y",
            "vars": [
                {
                    "name": "onlyOne",
                    "type": "string",
                    "default": "solo"
                }
            ]
        }
    ]
};

print "  Empty set created successfully";
print "  Single variable set: " + edgeCaseScreen.SingleVar.onlyOne;
print "✓ Edge cases handled";
print "";

// Test 8: Show screens to verify UI rendering
print "TEST 8: Displaying screens...";
screen comprehensiveScreen show;
print "✓ Comprehensive screen displayed";

screen areaTestScreen show;
print "✓ Area test screen displayed";
print "";

// Summary
print "========================================";
print "ALL TESTS PASSED SUCCESSFULLY!";
print "========================================";
print "";
print "Summary:";
print "  ✓ Multiple variable sets created";
print "  ✓ Visible sets (hiddenind='N') accessible";
print "  ✓ Hidden sets (hiddenind='Y') accessible";
print "  ✓ Variables modified across all sets";
print "  ✓ AreaItem linking verified";
print "  ✓ Type conversion working";
print "  ✓ Edge cases handled";
print "  ✓ UI rendering successful";
print "";
print "Variable Sets Structure: FULLY OPERATIONAL";
