// ============================================================
// EBS Test Script: Vector Image Filter Effects
// Tests: vector.applyblur, vector.applydropshadow,
//        vector.applygrayscale, vector.applysepia,
//        vector.applybrightness, vector.applyhuerotate
// ============================================================

print "========================================";
print "  Vector Image Filter Effects Tests";
print "========================================";
print "";

var testCount: int = 0;
var passCount: int = 0;
var failCount: int = 0;

// Test 1: Apply blur
print "Test 1: Apply blur filter with vector.applyblur()";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/white_king.svg");
    var blurred = call vector.applyblur(svg, 2.5);
    var saved: bool = call vector.save(blurred, "/tmp/test_filter_blur.svg");
    
    if saved then {
        print "  ✓ PASS: Applied blur filter (radius 2.5)";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 2: Apply drop shadow
print "Test 2: Apply drop shadow with vector.applydropshadow()";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/white_queen.svg");
    var shadow = call vector.applydropshadow(svg, 4.0, 4.0, 2.0, "#000000");
    var saved: bool = call vector.save(shadow, "/tmp/test_filter_shadow.svg");
    
    if saved then {
        print "  ✓ PASS: Applied drop shadow (dx=4, dy=4, blur=2)";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 3: Apply grayscale
print "Test 3: Apply grayscale filter with vector.applygrayscale()";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/black_rook.svg");
    var gray = call vector.applygrayscale(svg);
    var saved: bool = call vector.save(gray, "/tmp/test_filter_gray.svg");
    
    if saved then {
        print "  ✓ PASS: Applied grayscale filter";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 4: Apply sepia
print "Test 4: Apply sepia filter with vector.applysepia()";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/black_bishop.svg");
    var sepia = call vector.applysepia(svg);
    var saved: bool = call vector.save(sepia, "/tmp/test_filter_sepia.svg");
    
    if saved then {
        print "  ✓ PASS: Applied sepia filter";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 5: Apply brightness (darker)
print "Test 5: Apply brightness adjustment (darker) with vector.applybrightness()";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/white_knight.svg");
    var darker = call vector.applybrightness(svg, 0.5);
    var saved: bool = call vector.save(darker, "/tmp/test_filter_darker.svg");
    
    if saved then {
        print "  ✓ PASS: Applied brightness (factor=0.5)";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 6: Apply brightness (brighter)
print "Test 6: Apply brightness adjustment (brighter)";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/black_pawn.svg");
    var brighter = call vector.applybrightness(svg, 1.8);
    var saved: bool = call vector.save(brighter, "/tmp/test_filter_brighter.svg");
    
    if saved then {
        print "  ✓ PASS: Applied brightness (factor=1.8)";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 7: Apply hue rotate (120 degrees)
print "Test 7: Apply hue rotation with vector.applyhuerotate()";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/white_pawn.svg");
    var hue = call vector.applyhuerotate(svg, 120.0);
    var saved: bool = call vector.save(hue, "/tmp/test_filter_hue120.svg");
    
    if saved then {
        print "  ✓ PASS: Applied hue rotation (120°)";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 8: Apply hue rotate (240 degrees)
print "Test 8: Apply hue rotation (240 degrees)";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/black_queen.svg");
    var hue = call vector.applyhuerotate(svg, 240.0);
    var saved: bool = call vector.save(hue, "/tmp/test_filter_hue240.svg");
    
    if saved then {
        print "  ✓ PASS: Applied hue rotation (240°)";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Test 9: Combine multiple filters
print "Test 9: Combine multiple filters (blur + shadow)";
testCount = testCount + 1;
try {
    var svg = call vector.load("src/main/resources/images/chess/white_rook.svg");
    var blurred = call vector.applyblur(svg, 1.5);
    var combo = call vector.applydropshadow(blurred, 3.0, 3.0, 1.5, "#333333");
    var saved: bool = call vector.save(combo, "/tmp/test_filter_combo.svg");
    
    if saved then {
        print "  ✓ PASS: Combined blur and drop shadow";
        passCount = passCount + 1;
    } else {
        print "  ✗ FAIL: Failed to save";
        failCount = failCount + 1;
    }
} exceptions {
    when ANY_ERROR(msg) {
        print "  ✗ FAIL: " + msg;
        failCount = failCount + 1;
    }
}
print "";

// Summary
print "========================================";
print "  Test Summary";
print "========================================";
print "Total Tests:  " + testCount;
print "Passed:       " + passCount;
print "Failed:       " + failCount;
if failCount == 0 then {
    print "Result:       ALL TESTS PASSED ✓";
} else {
    print "Result:       SOME TESTS FAILED ✗";
}
print "========================================";
