// Test script for TreeView expand and collapse events

// Screen definition with TreeView
screen testTreeEvents {
    title = "TreeView Events Test"
    width = 800
    height = 600
    
    areas {
        mainArea {
            type = vbox
            items {
                // Label to show event information
                eventInfo {
                    displayItem {
                        type = label
                        labelText = "Expand or collapse tree nodes to see events"
                        itemFontSize = "14px"
                        itemBold = true
                    }
                }
                
                // TreeView with expand/collapse events
                fileTree {
                    displayItem {
                        type = treeview
                        displayRecords = 15
                        showRoot = true
                        treeItems = [
                            {
                                value = "Root",
                                expanded = true,
                                children = [
                                    {
                                        value = "src",
                                        expanded = false,
                                        children = [
                                            { value = "main.ebs" },
                                            { value = "utils.ebs" }
                                        ]
                                    },
                                    {
                                        value = "docs",
                                        expanded = false,
                                        children = [
                                            { value = "README.md" },
                                            { value = "GUIDE.md" }
                                        ]
                                    },
                                    {
                                        value = "tests",
                                        expanded = false,
                                        children = [
                                            { value = "test1.ebs" },
                                            { value = "test2.ebs" }
                                        ]
                                    }
                                ]
                            }
                        ]
                        onExpand = "
                            string expandedPath = fileTree.expandedItem;
                            call print('Node EXPANDED: ' + expandedPath);
                            call scr.setProperty('testTreeEvents', 'eventInfo', 'labelText', 'EXPANDED: ' + expandedPath);
                        "
                        onCollapse = "
                            string collapsedPath = fileTree.collapsedItem;
                            call print('Node COLLAPSED: ' + collapsedPath);
                            call scr.setProperty('testTreeEvents', 'eventInfo', 'labelText', 'COLLAPSED: ' + collapsedPath);
                        "
                    }
                }
                
                // Counter label
                eventCount {
                    displayItem {
                        type = label
                        labelText = "Event count: 0"
                        itemFontSize = "12px"
                    }
                }
                
                // Button to refresh counter
                refreshBtn {
                    displayItem {
                        type = button
                        labelText = "Refresh Event Count"
                        onClick = "
                            int expandCount = sys.getEventCount('testTreeEvents', 'fileTree', 'onExpand');
                            int collapseCount = sys.getEventCount('testTreeEvents', 'fileTree', 'onCollapse');
                            int total = expandCount + collapseCount;
                            call scr.setProperty('testTreeEvents', 'eventCount', 'labelText', 
                                'Events: ' + total + ' (Expand: ' + expandCount + ', Collapse: ' + collapseCount + ')');
                        "
                    }
                }
            }
        }
    }
}

// Show the screen
show screen testTreeEvents;

call print("TreeView events test screen created");
call print("Expand and collapse tree nodes to trigger events");
